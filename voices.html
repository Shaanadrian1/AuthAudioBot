<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Models - TTS Bot Admin</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        header { 
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        h1 { 
            color: #4f46e5;
            margin-bottom: 10px;
            font-size: 32px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h1 i { 
            color: #f59e0b;
        }
        
        .subtitle { 
            color: #6b7280;
            font-size: 16px;
        }
        
        .nav { 
            display: flex; 
            gap: 12px; 
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .nav a { 
            padding: 12px 24px; 
            background: #4f46e5; 
            color: white; 
            text-decoration: none; 
            border-radius: 8px; 
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav a:hover { 
            background: #4338ca;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
        }
        
        .nav a.active { 
            background: #3730a3;
        }
        
        .section { 
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .section h2 { 
            color: #374151; 
            margin-bottom: 25px; 
            padding-bottom: 15px; 
            border-bottom: 2px solid #e5e7eb;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Add New Voice Form */
        .add-voice-form {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #bae6fd;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group { 
            margin-bottom: 20px;
        }
        
        .form-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600;
            color: #374151;
        }
        
        .form-control { 
            width: 100%; 
            padding: 12px 15px; 
            border: 2px solid #d1d5db; 
            border-radius: 8px; 
            font-size: 15px;
            transition: all 0.3s;
        }
        
        .form-control:focus { 
            border-color: #4f46e5;
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        
        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236b7280' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            padding-right: 40px;
        }
        
        /* Voice Cards Grid */
        .voices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .voice-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            border: 1px solid #e5e7eb;
        }
        
        .voice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .voice-card-header {
            padding: 20px;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            position: relative;
        }
        
        .voice-card-image {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 15px;
        }
        
        .voice-card-name {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .voice-card-id {
            font-family: 'Courier New', monospace;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            word-break: break-all;
        }
        
        .voice-card-body {
            padding: 20px;
        }
        
        .voice-card-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #6b7280;
        }
        
        .detail-item i {
            width: 20px;
            color: #4f46e5;
        }
        
        .voice-card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* Buttons */
        .btn { 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary { 
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
        }
        
        .btn-primary:hover { 
            background: linear-gradient(135deg, #4338ca 0%, #6d28d9 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
        }
        
        .btn-success { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .btn-success:hover { 
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-danger { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .btn-danger:hover { 
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }
        
        .btn-warning { 
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .btn-warning:hover { 
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-2px);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 13px;
        }
        
        .btn-icon {
            padding: 10px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-active { 
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-inactive { 
            background: #fee2e2;
            color: #991b1b;
        }
        
        .status-premium { 
            background: #fef3c7;
            color: #92400e;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .modal-title {
            font-size: 24px;
            color: #374151;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: #ef4444;
        }
        
        /* Search and Filters */
        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .search-box {
            flex: 1;
            position: relative;
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 15px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            background: #f3f4f6;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: #4f46e5;
            border-color: #4f46e5;
            color: white;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #d1d5db;
        }
        
        /* Alert */
        .alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 350px;
            z-index: 9999;
        }
        
        .alert {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.3s ease-out;
        }
        
        .alert-success {
            background: #d1fae5;
            border-left: 5px solid #10b981;
            color: #065f46;
        }
        
        .alert-error {
            background: #fee2e2;
            border-left: 5px solid #ef4444;
            color: #991b1b;
        }
        
        .alert-warning {
            background: #fef3c7;
            border-left: 5px solid #f59e0b;
            color: #92400e;
        }
        
        .alert-icon {
            font-size: 24px;
        }
        
        /* Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .nav {
                flex-direction: column;
            }
            
            .voices-grid {
                grid-template-columns: 1fr;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .modal-content {
                padding: 20px;
                width: 95%;
            }
        }
        
        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f4f6;
            border-radius: 50%;
            border-top-color: #4f46e5;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Preview Player */
        .preview-player {
            background: #f9fafb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        audio {
            width: 100%;
            height: 40px;
            border-radius: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span>üéµ</span>
                Voice Models Management
            </h1>
            <p class="subtitle">Add, edit, and manage TTS voice models for your bot</p>
            
            <div class="nav">
                <a href="/admin/dashboard">
                    üìä Dashboard
                </a>
                <a href="/admin/codes">
                    üîë Access Codes
                </a>
                <a href="/admin/voices" class="active">
                    üéµ Voice Models
                </a>
                <a href="/admin/statistics">
                    üìà Statistics
                </a>
                <a href="/" style="background: #6b7280;">
                    üè† Home
                </a>
            </div>
        </header>

        <!-- Add New Voice Section -->
        <div class="section">
            <h2><span>‚ûï</span> Add New Voice Model</h2>
            
            <div class="add-voice-form">
                <form id="addVoiceForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="name">Display Name *</label>
                            <input type="text" id="name" name="name" class="form-control" 
                                   placeholder="e.g., Lovely Girl (Turbo)" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="voice_id">Voice ID *</label>
                            <input type="text" id="voice_id" name="voice_id" class="form-control" 
                                   placeholder="e.g., lovely_girl_audio_12345" required>
                            <small style="color: #6b7280; font-size: 12px;">Unique ID from Minimax API</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="model">Model Type *</label>
                            <select id="model" name="model" class="form-control" required>
                                <option value="speech-2.6-turbo">speech-2.6-turbo (Default)</option>
                                <option value="speech-2.0-turbo">speech-2.0-turbo</option>
                                <option value="speech-01">speech-01</option>
                                <option value="custom">Custom Model</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="language">Language *</label>
                            <select id="language" name="language" class="form-control" required>
                                <option value="en">English</option>
                                <option value="bn">Bengali</option>
                                <option value="hi">Hindi</option>
                                <option value="ur">Urdu</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="zh">Chinese</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select id="gender" name="gender" class="form-control">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="neutral">Neutral</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="age_group">Age Group</label>
                            <select id="age_group" name="age_group" class="form-control">
                                <option value="">Select Age Group</option>
                                <option value="child">Child</option>
                                <option value="young">Young</option>
                                <option value="adult">Adult</option>
                                <option value="elder">Elder</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="preview_url">Preview Audio URL</label>
                            <input type="url" id="preview_url" name="preview_url" class="form-control" 
                                   placeholder="https://example.com/voice-preview.mp3">
                            <small style="color: #6b7280; font-size: 12px;">MP3 or OGG format recommended</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="image_url">Voice Image URL</label>
                            <input type="url" id="image_url" name="image_url" class="form-control" 
                                   placeholder="https://example.com/voice-image.png">
                            <small style="color: #6b7280; font-size: 12px;">Square image recommended (400x400)</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" class="form-control" rows="3" 
                                  placeholder="Describe this voice model (e.g., Soft female voice suitable for storytelling)"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button type="submit" class="btn btn-success">
                            <span>‚ûï</span>
                            Add Voice Model
                        </button>
                        <button type="button" class="btn" onclick="clearForm()">
                            üóëÔ∏è Clear Form
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Manage Existing Voices -->
        <div class="section">
            <div class="search-container">
                <div class="search-box">
                    <div class="search-icon">üîç</div>
                    <input type="text" id="searchInput" placeholder="Search voices by name, language, or gender..." 
                           onkeyup="searchVoices()">
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterVoices('all')">All Voices</button>
                    <button class="filter-btn" onclick="filterVoices('active')">Active</button>
                    <button class="filter-btn" onclick="filterVoices('male')">Male</button>
                    <button class="filter-btn" onclick="filterVoices('female')">Female</button>
                    <button class="filter-btn" onclick="filterVoices('english')">English</button>
                    <button class="filter-btn" onclick="filterVoices('bengali')">Bengali</button>
                </div>
            </div>
            
            <h2><span>üé≠</span> Available Voice Models</h2>
            <p style="color: #6b7280; margin-bottom: 20px;">Click on any voice to preview or edit</p>
            
            <div id="voicesList" class="voices-grid">
                <!-- Voices will be loaded dynamically -->
                <div class="loading-spinner" style="grid-column: 1 / -1; justify-self: center; margin: 40px;"></div>
            </div>
        </div>

        <!-- Edit Voice Modal -->
        <div id="editVoiceModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">‚úèÔ∏è Edit Voice Model</h3>
                    <button class="modal-close" onclick="closeEditModal()">√ó</button>
                </div>
                
                <form id="editVoiceForm">
                    <input type="hidden" id="edit_voice_id">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="edit_name">Display Name</label>
                            <input type="text" id="edit_name" name="name" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit_voice_id_field">Voice ID</label>
                            <input type="text" id="edit_voice_id_field" name="voice_id" class="form-control" readonly style="background: #f3f4f6;">
                            <small style="color: #6b7280; font-size: 12px;">Voice ID cannot be changed</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit_model">Model Type</label>
                            <select id="edit_model" name="model" class="form-control" required>
                                <option value="speech-2.6-turbo">speech-2.6-turbo</option>
                                <option value="speech-2.0-turbo">speech-2.0-turbo</option>
                                <option value="speech-01">speech-01</option>
                                <option value="custom">Custom Model</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit_language">Language</label>
                            <select id="edit_language" name="language" class="form-control" required>
                                <option value="en">English</option>
                                <option value="bn">Bengali</option>
                                <option value="hi">Hindi</option>
                                <option value="ur">Urdu</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                                <option value="zh">Chinese</option>
                                <option value="ja">Japanese</option>
                                <option value="ko">Korean</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit_gender">Gender</label>
                            <select id="edit_gender" name="gender" class="form-control">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="neutral">Neutral</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit_age_group">Age Group</label>
                            <select id="edit_age_group" name="age_group" class="form-control">
                                <option value="">Select Age Group</option>
                                <option value="child">Child</option>
                                <option value="young">Young</option>
                                <option value="adult">Adult</option>
                                <option value="elder">Elder</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="edit_preview_url">Preview Audio URL</label>
                            <input type="url" id="edit_preview_url" name="preview_url" class="form-control">
                            <div class="preview-player" id="audioPreview" style="display: none;">
                                <audio controls id="previewAudio"></audio>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="edit_image_url">Voice Image URL</label>
                            <input type="url" id="edit_image_url" name="image_url" class="form-control">
                            <div style="margin-top: 10px; text-align: center;" id="imagePreview">
                                <!-- Image preview will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit_description">Description</label>
                        <textarea id="edit_description" name="description" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="edit_is_active" name="is_active" checked>
                            <span>Voice is active (available for users)</span>
                        </label>
                        
                        <label style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                            <input type="checkbox" id="edit_is_premium" name="is_premium">
                            <span>Premium voice (requires special access)</span>
                        </label>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px;">
                        <button type="submit" class="btn btn-success">
                            üíæ Save Changes
                        </button>
                        <button type="button" class="btn btn-danger" onclick="deleteVoice()">
                            üóëÔ∏è Delete Voice
                        </button>
                        <button type="button" class="btn" onclick="closeEditModal()">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alertContainer" class="alert-container"></div>
    </div>

    <script>
        // Global variables
        let allVoices = [];
        let currentFilter = 'all';
        let currentEditVoiceId = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadVoices();
            
            // Form submission handlers
            document.getElementById('addVoiceForm').addEventListener('submit', handleAddVoice);
            document.getElementById('editVoiceForm').addEventListener('submit', handleEditVoice);
            
            // Live preview for URLs
            document.getElementById('edit_preview_url').addEventListener('input', previewAudio);
            document.getElementById('edit_image_url').addEventListener('input', previewImage);
        });

        // Load all voices from API
        async function loadVoices() {
            try {
                showLoading(true);
                
                const response = await fetch('/api/admin/voices');
                if (!response.ok) throw new Error('Failed to load voices');
                
                allVoices = await response.json();
                renderVoices(allVoices);
                
            } catch (error) {
                showAlert('‚ùå Failed to load voices: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Render voices in grid
        function renderVoices(voices) {
            const container = document.getElementById('voicesList');
            
            if (!voices || voices.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div>üîá</div>
                        <h3>No Voice Models Found</h3>
                        <p>Add your first voice model using the form above</p>
                        <button class="btn btn-primary" onclick="document.getElementById('name').focus()">
                            ‚ûï Add First Voice
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = voices.map(voice => `
                <div class="voice-card" data-voice-id="${voice.id}" data-language="${voice.language}" data-gender="${voice.gender || ''}">
                    <div class="voice-card-header">
                        <img src="${voice.image_url || 'https://via.placeholder.com/80/4f46e5/ffffff?text=VOICE'}" 
                             alt="${voice.name}" 
                             class="voice-card-image"
                             onerror="this.src='https://via.placeholder.com/80/4f46e5/ffffff?text=VOICE'">
                        <div class="voice-card-name">${voice.name}</div>
                        <div class="voice-card-id" title="${voice.voice_id}">${voice.voice_id.substring(0, 20)}${voice.voice_id.length > 20 ? '...' : ''}</div>
                    </div>
                    
                    <div class="voice-card-body">
                        <div class="voice-card-details">
                            <div class="detail-item">
                                <span>üéØ</span>
                                <span><strong>Model:</strong> ${voice.model || 'speech-2.6-turbo'}</span>
                            </div>
                            <div class="detail-item">
                                <span>üåê</span>
                                <span><strong>Language:</strong> ${getLanguageName(voice.language)}</span>
                            </div>
                            <div class="detail-item">
                                <span>üë§</span>
                                <span><strong>Gender:</strong> ${voice.gender ? voice.gender.charAt(0).toUpperCase() + voice.gender.slice(1) : 'Not specified'}</span>
                            </div>
                            ${voice.age_group ? `
                            <div class="detail-item">
                                <span>üë∂</span>
                                <span><strong>Age Group:</strong> ${voice.age_group.charAt(0).toUpperCase() + voice.age_group.slice(1)}</span>
                            </div>` : ''}
                            ${voice.description ? `
                            <div class="detail-item">
                                <span>üìù</span>
                                <span><strong>Description:</strong> ${voice.description.substring(0, 100)}${voice.description.length > 100 ? '...' : ''}</span>
                            </div>` : ''}
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <div>
                                <span class="status-badge ${voice.is_active ? 'status-active' : 'status-inactive'}">
                                    ${voice.is_active ? '‚úÖ Active' : '‚ùå Inactive'}
                                </span>
                                ${voice.is_premium ? `<span class="status-badge status-premium" style="margin-left: 5px;">‚≠ê Premium</span>` : ''}
                            </div>
                            
                            <div class="voice-card-actions">
                                ${voice.preview_url ? `
                                <button class="btn btn-icon btn-primary" onclick="playPreview('${voice.preview_url}', event)" title="Preview">
                                    ‚ñ∂Ô∏è
                                </button>
                                ` : ''}
                                
                                <button class="btn btn-icon btn-warning" onclick="editVoice('${voice.id}', event)" title="Edit">
                                    ‚úèÔ∏è
                                </button>
                                
                                <button class="btn btn-icon btn-danger" onclick="confirmDeleteVoice('${voice.id}', event)" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Handle add voice form submission
        async function handleAddVoice(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            try {
                showLoading(true, form.querySelector('button[type="submit"]'));
                
                const response = await fetch('/api/admin/voices/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('‚úÖ Voice model added successfully!', 'success');
                    form.reset();
                    await loadVoices();
                } else {
                    showAlert(`‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                showAlert('‚ùå Failed to add voice: ' + error.message, 'error');
            } finally {
                showLoading(false, form.querySelector('button[type="submit"]'));
            }
        }

        // Open edit voice modal
        async function editVoice(voiceId, event) {
            if (event) event.stopPropagation();
            
            try {
                showLoading(true);
                
                // Find voice in local data first
                const voice = allVoices.find(v => v.id == voiceId);
                if (!voice) throw new Error('Voice not found');
                
                // Populate edit form
                document.getElementById('edit_voice_id').value = voice.id;
                document.getElementById('edit_name').value = voice.name || '';
                document.getElementById('edit_voice_id_field').value = voice.voice_id || '';
                document.getElementById('edit_model').value = voice.model || 'speech-2.6-turbo';
                document.getElementById('edit_language').value = voice.language || 'en';
                document.getElementById('edit_gender').value = voice.gender || '';
                document.getElementById('edit_age_group').value = voice.age_group || '';
                document.getElementById('edit_preview_url').value = voice.preview_url || '';
                document.getElementById('edit_image_url').value = voice.image_url || '';
                document.getElementById('edit_description').value = voice.description || '';
                document.getElementById('edit_is_active').checked = voice.is_active !== false;
                document.getElementById('edit_is_premium').checked = voice.is_premium === true;
                
                // Store current editing voice ID
                currentEditVoiceId = voice.id;
                
                // Show modal
                document.getElementById('editVoiceModal').style.display = 'flex';
                
                // Trigger previews
                if (voice.preview_url) previewAudio();
                if (voice.image_url) previewImage();
                
            } catch (error) {
                showAlert('‚ùå Failed to load voice details: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Handle edit voice form submission
        async function handleEditVoice(event) {
            event.preventDefault();
            
            if (!currentEditVoiceId) return;
            
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            try {
                showLoading(true, form.querySelector('button[type="submit"]'));
                
                const response = await fetch(`/api/admin/voices/${currentEditVoiceId}/update`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('‚úÖ Voice model updated successfully!', 'success');
                    closeEditModal();
                    await loadVoices();
                } else {
                    showAlert(`‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                showAlert('‚ùå Failed to update voice: ' + error.message, 'error');
            } finally {
                showLoading(false, form.querySelector('button[type="submit"]'));
            }
        }

        // Delete voice
        async function deleteVoice() {
            if (!currentEditVoiceId) return;
            
            if (!confirm('Are you sure you want to delete this voice model? This action cannot be undone.')) {
                return;
            }
            
            try {
                showLoading(true);
                
                const response = await fetch(`/api/admin/voices/${currentEditVoiceId}/delete`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('‚úÖ Voice model deleted successfully!', 'success');
                    closeEditModal();
                    await loadVoices();
                } else {
                    showAlert(`‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                showAlert('‚ùå Failed to delete voice: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // Confirm delete (with icon button)
        function confirmDeleteVoice(voiceId, event) {
            if (event) event.stopPropagation();
            
            if (confirm('Are you sure you want to delete this voice model?')) {
                fetch(`/api/admin/voices/${voiceId}/delete`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(result => {
                    if (result.success) {
                        showAlert('‚úÖ Voice deleted successfully!', 'success');
                        loadVoices();
                    } else {
                        showAlert(`‚ùå ${result.message}`, 'error');
                    }
                })
                .catch(error => {
                    showAlert('‚ùå Failed to delete voice', 'error');
                });
            }
        }

        // Play preview audio
        function playPreview(audioUrl, event) {
            if (event) event.stopPropagation();
            
            const audio = new Audio(audioUrl);
            audio.play().catch(e => {
                showAlert('‚ùå Could not play preview audio', 'warning');
            });
        }

        // Search voices
        function searchVoices() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (!searchTerm) {
                filterVoices(currentFilter);
                return;
            }
            
            const filtered = allVoices.filter(voice => 
                voice.name.toLowerCase().includes(searchTerm) ||
                voice.voice_id.toLowerCase().includes(searchTerm) ||
                (voice.language && voice.language.toLowerCase().includes(searchTerm)) ||
                (voice.gender && voice.gender.toLowerCase().includes(searchTerm)) ||
                (voice.description && voice.description.toLowerCase().includes(searchTerm))
            );
            
            renderVoices(filtered);
        }

        // Filter voices
        function filterVoices(filter) {
            currentFilter = filter;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            let filtered = allVoices;
            
            switch(filter) {
                case 'active':
                    filtered = allVoices.filter(v => v.is_active !== false);
                    break;
                case 'male':
                    filtered = allVoices.filter(v => v.gender === 'male');
                    break;
                case 'female':
                    filtered = allVoices.filter(v => v.gender === 'female');
                    break;
                case 'english':
                    filtered = allVoices.filter(v => v.language === 'en');
                    break;
                case 'bengali':
                    filtered = allVoices.filter(v => v.language === 'bn');
                    break;
                // 'all' - no filter
            }
            
            renderVoices(filtered);
        }

        // Preview audio in edit modal
        function previewAudio() {
            const audioUrl = document.getElementById('edit_preview_url').value;
            const previewDiv = document.getElementById('audioPreview');
            const audioElement = document.getElementById('previewAudio');
            
            if (audioUrl) {
                audioElement.src = audioUrl;
                previewDiv.style.display = 'block';
            } else {
                previewDiv.style.display = 'none';
                audioElement.src = '';
            }
        }

        // Preview image in edit modal
        function previewImage() {
            const imageUrl = document.getElementById('edit_image_url').value;
            const previewDiv = document.getElementById('imagePreview');
            
            if (imageUrl) {
                previewDiv.innerHTML = `
                    <img src="${imageUrl}" 
                         alt="Preview" 
                         style="max-width: 100px; max-height: 100px; border-radius: 8px; border: 2px solid #e5e7eb;"
                         onerror="this.src='https://via.placeholder.com/100/4f46e5/ffffff?text=VOICE'">
                    <div style="margin-top: 5px; font-size: 12px; color: #6b7280;">Image Preview</div>
                `;
            } else {
                previewDiv.innerHTML = '';
            }
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editVoiceModal').style.display = 'none';
            currentEditVoiceId = null;
        }

        // Clear add form
        function clearForm() {
            document.getElementById('addVoiceForm').reset();
        }

        // Show loading state
        function showLoading(isLoading, button = null) {
            if (button) {
                if (isLoading) {
                    button.innerHTML = '<span class="loading-spinner"></span> Processing...';
                    button.disabled = true;
                } else {
                    button.innerHTML = button.getAttribute('data-original-text') || 'Add Voice Model';
                    button.disabled = false;
                }
            } else {
                const container = document.getElementById('voicesList');
                if (isLoading) {
                    container.innerHTML = '<div class="loading-spinner" style="grid-column: 1 / -1; justify-self: center; margin: 40px;"></div>';
                }
            }
        }

        // Show alert message
        function showAlert(message, type = 'success') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
            
            alert.innerHTML = `
                <div class="alert-icon">${icon}</div>
                <div>
                    <div style="font-weight: 600; margin-bottom: 5px;">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div>${message}</div>
                </div>
            `;
            
            container.appendChild(alert);
            
            // Remove alert after 5 seconds
            setTimeout(() => {
                alert.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => alert.remove(), 300);
            }, 5000);
        }

        // Helper: Get language name from code
        function getLanguageName(code) {
            const languages = {
                'en': 'English',
                'bn': 'Bengali',
                'hi': 'Hindi',
                'ur': 'Urdu',
                'es': 'Spanish',
                'fr': 'French',
                'de': 'German',
                'zh': 'Chinese',
                'ja': 'Japanese',
                'ko': 'Korean'
            };
            return languages[code] || code;
        }

        // Voice card click handler
        document.addEventListener('click', function(event) {
            const voiceCard = event.target.closest('.voice-card');
            if (voiceCard && !event.target.closest('.voice-card-actions')) {
                const voiceId = voiceCard.dataset.voiceId;
                editVoice(voiceId);
            }
        });
    </script>
</body>
</html>